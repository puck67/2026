<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>V≈© Tr·ª• K√Ω ·ª®c - Happy New Year 2026</title>

    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;600;700&family=Dancing+Script:wght@400;700&display=swap" rel="stylesheet">

    <style>
        /* ==================== RESET & BASE ==================== */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Montserrat', sans-serif;
            overflow: hidden;
            background: #000000;
            color: #ffffff;
            position: relative;
            width: 100vw;
            height: 100vh;
            -webkit-user-select: none;
            user-select: none;
        }

        /* ==================== CANVAS 3D ==================== */
        #canvas3d {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 1;
            touch-action: none;
        }

        /* ==================== UI OVERLAY ==================== */
        .overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 10;
            pointer-events: none;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        /* ==================== COUNTDOWN ==================== */
        #countdown {
            font-size: 18px;
            font-weight: 300;
            letter-spacing: 2px;
            text-align: center;
            text-shadow: 0 0 20px rgba(255, 105, 180, 0.8),
                         0 0 40px rgba(138, 43, 226, 0.6);
            margin-top: 40vh;
            opacity: 0;
            transition: opacity 0.5s ease;
        }

        #countdown.show {
            opacity: 1;
        }

        #countdown .time-unit {
            display: inline-block;
            margin: 0 8px;
        }

        #countdown .number {
            font-size: 32px;
            font-weight: 600;
            color: #ff69b4;
        }

        #countdown .label {
            font-size: 14px;
            color: #ba7bff;
            display: block;
        }

        /* ==================== NEW YEAR MESSAGE ==================== */
        #newYearMessage {
            text-align: center;
            opacity: 0;
            transition: opacity 0.8s ease;
            margin-top: 20vh;
        }

        #newYearMessage.show {
            opacity: 1;
        }

        #newYearMessage h1 {
            font-family: 'Dancing Script', cursive;
            font-size: 42px;
            font-weight: 700;
            background: linear-gradient(45deg, #ff69b4, #ba7bff, #ff1493);
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
            text-shadow: 0 0 30px rgba(255, 105, 180, 0.5);
            margin-bottom: 30px;
            line-height: 1.4;
        }

        #btnShowMessage {
            font-family: 'Montserrat', sans-serif;
            font-size: 16px;
            font-weight: 600;
            padding: 15px 40px;
            background: linear-gradient(135deg, #ff69b4, #8a2be2);
            border: none;
            border-radius: 50px;
            color: white;
            cursor: pointer;
            box-shadow: 0 5px 25px rgba(255, 105, 180, 0.5);
            transition: all 0.3s ease;
            pointer-events: auto;
        }

        #btnShowMessage:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 35px rgba(255, 105, 180, 0.7);
        }

        #btnShowMessage:active {
            transform: translateY(-1px);
        }

        /* ==================== MESSAGE MODAL ==================== */
        #messageModal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            z-index: 100;
            display: none;
            justify-content: center;
            align-items: center;
            pointer-events: auto;
        }

        #messageModal.show {
            display: flex;
        }

        .modal-content {
            background: linear-gradient(135deg, rgba(138, 43, 226, 0.3), rgba(255, 105, 180, 0.3));
            backdrop-filter: blur(10px);
            border: 2px solid rgba(255, 105, 180, 0.5);
            border-radius: 20px;
            padding: 40px 30px;
            max-width: 90%;
            max-height: 80%;
            overflow-y: auto;
            box-shadow: 0 10px 50px rgba(255, 105, 180, 0.4);
        }

        .modal-content h2 {
            font-family: 'Dancing Script', cursive;
            font-size: 32px;
            margin-bottom: 20px;
            color: #ff69b4;
            text-align: center;
        }

        .modal-content p {
            font-size: 16px;
            line-height: 1.8;
            color: #ffffff;
            text-align: center;
            margin-bottom: 30px;
        }

        #btnCloseModal {
            font-family: 'Montserrat', sans-serif;
            font-size: 14px;
            padding: 10px 30px;
            background: rgba(255, 105, 180, 0.3);
            border: 1px solid #ff69b4;
            border-radius: 25px;
            color: white;
            cursor: pointer;
            display: block;
            margin: 0 auto;
            transition: all 0.3s ease;
        }

        #btnCloseModal:hover {
            background: rgba(255, 105, 180, 0.5);
        }

        /* ==================== MUSIC CONTROL ==================== */
        #musicControl {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 50;
            width: 50px;
            height: 50px;
            background: rgba(255, 105, 180, 0.3);
            border: 2px solid #ff69b4;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            pointer-events: auto;
            transition: all 0.3s ease;
            box-shadow: 0 5px 20px rgba(255, 105, 180, 0.4);
        }

        #musicControl:hover {
            background: rgba(255, 105, 180, 0.5);
            transform: scale(1.1);
        }

        #musicControl svg {
            width: 24px;
            height: 24px;
            fill: white;
        }

        /* ==================== FIREWORKS CANVAS ==================== */
        #fireworksCanvas {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 5;
            pointer-events: none;
            display: none;
        }

        #fireworksCanvas.show {
            display: block;
        }

        /* ==================== RESPONSIVE ==================== */
        @media (max-width: 600px) {
            #countdown .number {
                font-size: 24px;
            }

            #countdown .label {
                font-size: 12px;
            }

            #newYearMessage h1 {
                font-size: 32px;
            }

            #btnShowMessage {
                font-size: 14px;
                padding: 12px 30px;
            }

            .modal-content {
                padding: 30px 20px;
            }

            .modal-content h2 {
                font-size: 26px;
            }

            .modal-content p {
                font-size: 14px;
            }
        }
    </style>
</head>
<body>
    <!-- Canvas cho Three.js -->
    <canvas id="canvas3d"></canvas>

    <!-- Canvas cho ph√°o hoa -->
    <canvas id="fireworksCanvas"></canvas>

    <!-- UI Overlay -->
    <div class="overlay">
        <!-- ƒê·ªìng h·ªì ƒë·∫øm ng∆∞·ª£c (hi·ªán khi ch∆∞a t·ªõi nƒÉm m·ªõi) -->
        <div id="countdown">
            <div class="time-unit">
                <span class="number" id="days">00</span>
                <span class="label">ng√†y</span>
            </div>
            <div class="time-unit">
                <span class="number" id="hours">00</span>
                <span class="label">gi·ªù</span>
            </div>
            <div class="time-unit">
                <span class="number" id="minutes">00</span>
                <span class="label">ph√∫t</span>
            </div>
            <div class="time-unit">
                <span class="number" id="seconds">00</span>
                <span class="label">gi√¢y</span>
            </div>
        </div>

        <!-- Th√¥ng ƒëi·ªáp nƒÉm m·ªõi (hi·ªán khi ƒë√£ qua nƒÉm m·ªõi) -->
        <div id="newYearMessage">
            <h1>Happy New Year 2026,<br>My Love ‚ù§Ô∏è</h1>
            <button id="btnShowMessage">Xem l·ªùi ch√∫c</button>
        </div>
    </div>

    <!-- Modal l·ªùi ch√∫c -->
    <div id="messageModal">
        <div class="modal-content">
            <h2>L·ªùi ch√∫c nƒÉm m·ªõi 2026 üíù</h2>
            <p id="messageText">
                <!-- Thay l·ªùi ch√∫c c·ªßa b·∫°n ·ªü ƒë√¢y -->
                Em y√™u ∆°i,<br><br>
                NƒÉm m·ªõi 2026 ƒë√£ ƒë·∫øn r·ªìi ƒë√≥! Anh mu·ªën g·ª≠i ƒë·∫øn em nh·ªØng ƒëi·ªÅu t·ªët ƒë·∫πp nh·∫•t,<br>
                nh·ªØng n·ª• c∆∞·ªùi r·∫°ng r·ª° nh·∫•t, v√† t√¨nh y√™u th∆∞∆°ng v√¥ t·∫≠n.<br><br>
                C·∫£m ∆°n em ƒë√£ lu√¥n ·ªü b√™n anh, l√†m cu·ªôc ƒë·ªùi anh th√™m √Ω nghƒ©a.<br>
                Ch√∫c em lu√¥n kh·ªèe m·∫°nh, h·∫°nh ph√∫c v√† th√†nh c√¥ng trong m·ªçi ƒëi·ªÅu.<br><br>
                Y√™u em nhi·ªÅu l·∫Øm! üíñ<br>
                - Anh c·ªßa em -
            </p>
            <button id="btnCloseModal">ƒê√≥ng</button>
        </div>
    </div>

    <!-- N√∫t ƒëi·ªÅu khi·ªÉn nh·∫°c -->
    <div id="musicControl" title="B·∫≠t/T·∫Øt nh·∫°c">
        <svg id="musicIcon" viewBox="0 0 24 24">
            <path d="M3 9v6h4l5 5V4L7 9H3zm13.5 3c0-1.77-1.02-3.29-2.5-4.03v8.05c1.48-.73 2.5-2.25 2.5-4.02z"/>
        </svg>
    </div>

    <!-- Audio (th√™m link nh·∫°c c·ªßa b·∫°n v√†o src) -->
    <audio id="bgMusic" loop>
        <!-- Thay link nh·∫°c n·ªÅn c·ªßa b·∫°n ·ªü ƒë√¢y -->
        <source src="" type="audio/mpeg">
    </audio>

    <!-- Three.js t·ª´ CDN -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>

    <script>
        // ==================== BI·∫æN C·∫§U H√åNH (C√≥ th·ªÉ ch·ªânh s·ª≠a) ====================

        // L·ªùi ch√∫c (c√≥ th·ªÉ thay ƒë·ªïi n·ªôi dung trong HTML ph√≠a tr√™n ho·∫∑c qua JS)
        const MESSAGE = `Em y√™u ∆°i,

NƒÉm m·ªõi 2026 ƒë√£ ƒë·∫øn r·ªìi ƒë√≥! Anh mu·ªën g·ª≠i ƒë·∫øn em nh·ªØng ƒëi·ªÅu t·ªët ƒë·∫πp nh·∫•t,
nh·ªØng n·ª• c∆∞·ªùi r·∫°ng r·ª° nh·∫•t, v√† t√¨nh y√™u th∆∞∆°ng v√¥ t·∫≠n.

C·∫£m ∆°n em ƒë√£ lu√¥n ·ªü b√™n anh, l√†m cu·ªôc ƒë·ªùi anh th√™m √Ω nghƒ©a.
Ch√∫c em lu√¥n kh·ªèe m·∫°nh, h·∫°nh ph√∫c v√† th√†nh c√¥ng trong m·ªçi ƒëi·ªÅu.

Y√™u em nhi·ªÅu l·∫Øm! üíñ
- Anh c·ªßa em -`;

        // Link ·∫£nh (d·ª± ph√≤ng cho texture particles n·∫øu c·∫ßn)
        const IMG_URL = ''; // ƒê·ªÉ tr·ªëng ho·∫∑c thay link ·∫£nh texture

        // S·ªë l∆∞·ª£ng h·∫°t (gi·∫£m xu·ªëng cho mobile, tƒÉng l√™n cho desktop m·∫°nh h∆°n)
        const PARTICLE_COUNT = 1800; // Ch·ªânh ·ªü ƒë√¢y ƒë·ªÉ tƒÉng/gi·∫£m s·ªë h·∫°t

        // T·ªëc ƒë·ªô xoay t·ª± ƒë·ªông (khi kh√¥ng c√≥ gyroscope)
        const AUTO_ROTATION_SPEED = 0.001; // Ch·ªânh ·ªü ƒë√¢y ƒë·ªÉ ƒëi·ªÅu ch·ªânh t·ªëc ƒë·ªô xoay

        // M·ªëc th·ªùi gian nƒÉm m·ªõi
        const NEW_YEAR_2026 = new Date('2026-01-01T00:00:00').getTime();

        // ==================== BI·∫æN TO√ÄN C·ª§C ====================

        let scene, camera, renderer, particles;
        let gyroPermissionGranted = false;
        let mouseX = 0, mouseY = 0;
        let targetRotationX = 0, targetRotationY = 0;
        let currentRotationX = 0, currentRotationY = 0;
        let isMusicPlaying = false;
        let isNewYear = false;

        // Elements
        const canvas3d = document.getElementById('canvas3d');
        const countdown = document.getElementById('countdown');
        const newYearMessage = document.getElementById('newYearMessage');
        const messageModal = document.getElementById('messageModal');
        const musicControl = document.getElementById('musicControl');
        const bgMusic = document.getElementById('bgMusic');
        const fireworksCanvas = document.getElementById('fireworksCanvas');

        // ==================== KH·ªûI T·∫†O THREE.JS ====================

        function initThreeJS() {
            // Scene
            scene = new THREE.Scene();

            // Camera (Perspective cho c·∫£m gi√°c 3D)
            camera = new THREE.PerspectiveCamera(
                75,
                window.innerWidth / window.innerHeight,
                0.1,
                1000
            );
            camera.position.z = 50;

            // Renderer
            renderer = new THREE.WebGLRenderer({
                canvas: canvas3d,
                antialias: true,
                alpha: true
            });
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2)); // Gi·ªõi h·∫°n cho mobile

            // T·∫°o h·∫°t h√¨nh tr√°i tim
            createHeartParticles();

            // T·∫°o sao n·ªÅn
            createStarfield();

            // X·ª≠ l√Ω resize
            window.addEventListener('resize', onWindowResize);
        }

        // ==================== T·∫†O H·∫†T H√åNH TR√ÅI TIM ====================

        function createHeartParticles() {
            const geometry = new THREE.BufferGeometry();
            const positions = [];
            const colors = [];

            // T·∫°o ƒëi·ªÉm theo c√¥ng th·ª©c to√°n h·ªçc h√¨nh tr√°i tim 3D
            for (let i = 0; i < PARTICLE_COUNT; i++) {
                // Tham s·ªë ng·∫´u nhi√™n
                const t = Math.random() * Math.PI * 2;
                const u = Math.random() * Math.PI * 2;

                // C√¥ng th·ª©c h√¨nh tr√°i tim 3D (Heart Surface)
                const scale = 5; // K√≠ch th∆∞·ªõc tr√°i tim
                const x = scale * (16 * Math.pow(Math.sin(t), 3));
                const y = scale * (13 * Math.cos(t) - 5 * Math.cos(2 * t) - 2 * Math.cos(3 * t) - Math.cos(4 * t));
                const z = scale * Math.sin(u) * 3; // Th√™m chi·ªÅu s√¢u

                // Th√™m nhi·ªÖu ng·∫´u nhi√™n ƒë·ªÉ t·∫°o ƒë√°m m√¢y
                const noise = 0.5;
                positions.push(
                    x + (Math.random() - 0.5) * noise,
                    y + (Math.random() - 0.5) * noise,
                    z + (Math.random() - 0.5) * noise
                );

                // M√†u h·ªìng pastel v√† t√≠m neon
                const color = new THREE.Color();
                if (Math.random() > 0.5) {
                    color.setHSL(0.92, 1.0, 0.7); // H·ªìng pastel
                } else {
                    color.setHSL(0.78, 1.0, 0.6); // T√≠m neon
                }
                colors.push(color.r, color.g, color.b);
            }

            geometry.setAttribute('position', new THREE.Float32BufferAttribute(positions, 3));
            geometry.setAttribute('color', new THREE.Float32BufferAttribute(colors, 3));

            // Material
            const material = new THREE.PointsMaterial({
                size: 0.3, // K√≠ch th∆∞·ªõc h·∫°t
                vertexColors: true,
                transparent: true,
                opacity: 0.8,
                blending: THREE.AdditiveBlending,
                depthWrite: false
            });

            particles = new THREE.Points(geometry, material);
            scene.add(particles);
        }

        // ==================== T·∫†O SAO N·ªÄN ====================

        function createStarfield() {
            const starGeometry = new THREE.BufferGeometry();
            const starPositions = [];

            for (let i = 0; i < 500; i++) {
                starPositions.push(
                    (Math.random() - 0.5) * 200,
                    (Math.random() - 0.5) * 200,
                    (Math.random() - 0.5) * 200
                );
            }

            starGeometry.setAttribute('position', new THREE.Float32BufferAttribute(starPositions, 3));

            const starMaterial = new THREE.PointsMaterial({
                color: 0xffffff,
                size: 0.1,
                transparent: true,
                opacity: 0.6
            });

            const stars = new THREE.Points(starGeometry, starMaterial);
            scene.add(stars);
        }

        // ==================== ANIMATION LOOP ====================

        function animate() {
            requestAnimationFrame(animate);

            // Hi·ªáu ·ª©ng th·ªü (floating)
            const time = Date.now() * 0.001;
            if (particles) {
                particles.rotation.y = currentRotationY;
                particles.rotation.x = currentRotationX;

                // Chuy·ªÉn ƒë·ªông nh·∫π l√™n xu·ªëng
                particles.position.y = Math.sin(time * 0.5) * 0.5;

                // Scale nh·∫π (th·ªü)
                const breathScale = 1 + Math.sin(time * 0.8) * 0.05;
                particles.scale.set(breathScale, breathScale, breathScale);
            }

            // L√†m m∆∞·ª£t rotation (easing)
            currentRotationX += (targetRotationX - currentRotationX) * 0.05;
            currentRotationY += (targetRotationY - currentRotationY) * 0.05;

            // Xoay t·ª± ƒë·ªông nh·∫π khi kh√¥ng t∆∞∆°ng t√°c
            if (!gyroPermissionGranted && mouseX === 0 && mouseY === 0) {
                targetRotationY += AUTO_ROTATION_SPEED;
            }

            renderer.render(scene, camera);
        }

        // ==================== GYROSCOPE (C·∫£m bi·∫øn con quay h·ªìi chuy·ªÉn) ====================

        function requestGyroPermission() {
            if (typeof DeviceOrientationEvent !== 'undefined' && typeof DeviceOrientationEvent.requestPermission === 'function') {
                // iOS 13+ c·∫ßn xin ph√©p
                DeviceOrientationEvent.requestPermission()
                    .then(permissionState => {
                        if (permissionState === 'granted') {
                            enableGyroscope();
                        } else {
                            console.log('Gyroscope permission denied');
                            useFallbackControls();
                        }
                    })
                    .catch(console.error);
            } else if (window.DeviceOrientationEvent) {
                // Android v√† tr√¨nh duy·ªát kh√°c
                enableGyroscope();
            } else {
                // Kh√¥ng h·ªó tr·ª£ gyroscope
                useFallbackControls();
            }
        }

        function enableGyroscope() {
            gyroPermissionGranted = true;
            window.addEventListener('deviceorientation', handleOrientation);
        }

        function handleOrientation(event) {
            // Beta: nghi√™ng tr∆∞·ªõc/sau (-180 ƒë·∫øn 180)
            // Gamma: nghi√™ng tr√°i/ph·∫£i (-90 ƒë·∫øn 90)
            const beta = event.beta; // Tr∆∞·ªõc/sau
            const gamma = event.gamma; // Tr√°i/ph·∫£i

            // Chuy·ªÉn ƒë·ªïi sang radian v√† gi·ªõi h·∫°n
            targetRotationX = (beta / 180) * Math.PI * 0.3;
            targetRotationY = (gamma / 90) * Math.PI * 0.3;
        }

        // ==================== FALLBACK CONTROLS (Chu·ªôt/Touch) ====================

        function useFallbackControls() {
            // Mouse
            document.addEventListener('mousemove', (event) => {
                mouseX = (event.clientX / window.innerWidth) * 2 - 1;
                mouseY = -(event.clientY / window.innerHeight) * 2 + 1;
                targetRotationY = mouseX * Math.PI * 0.3;
                targetRotationX = mouseY * Math.PI * 0.3;
            });

            // Touch
            document.addEventListener('touchmove', (event) => {
                if (event.touches.length > 0) {
                    const touch = event.touches[0];
                    mouseX = (touch.clientX / window.innerWidth) * 2 - 1;
                    mouseY = -(touch.clientY / window.innerHeight) * 2 + 1;
                    targetRotationY = mouseX * Math.PI * 0.3;
                    targetRotationX = mouseY * Math.PI * 0.3;
                }
            });
        }

        // ==================== TOUCH INTERACTION (Tap ƒë·ªÉ t·∫°o hi·ªáu ·ª©ng pulse) ====================

        function initTouchInteraction() {
            canvas3d.addEventListener('click', pulseEffect);
            canvas3d.addEventListener('touchstart', pulseEffect);
        }

        function pulseEffect() {
            if (!particles) return;

            // T·∫°o hi·ªáu ·ª©ng bung ra r·ªìi t·ª• l·∫°i
            const positions = particles.geometry.attributes.position.array;
            const originalPositions = positions.slice();

            // Bung ra
            for (let i = 0; i < positions.length; i += 3) {
                positions[i] *= 1.5;
                positions[i + 1] *= 1.5;
                positions[i + 2] *= 1.5;
            }
            particles.geometry.attributes.position.needsUpdate = true;

            // T·ª• l·∫°i sau 300ms
            setTimeout(() => {
                for (let i = 0; i < positions.length; i++) {
                    positions[i] = originalPositions[i];
                }
                particles.geometry.attributes.position.needsUpdate = true;
            }, 300);
        }

        // ==================== COUNTDOWN LOGIC ====================

        function updateCountdown() {
            const now = new Date().getTime();
            const distance = NEW_YEAR_2026 - now;

            if (distance > 0) {
                // Ch∆∞a t·ªõi nƒÉm m·ªõi
                isNewYear = false;
                countdown.classList.add('show');
                newYearMessage.classList.remove('show');
                fireworksCanvas.classList.remove('show');

                const days = Math.floor(distance / (1000 * 60 * 60 * 24));
                const hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                const minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
                const seconds = Math.floor((distance % (1000 * 60)) / 1000);

                document.getElementById('days').textContent = String(days).padStart(2, '0');
                document.getElementById('hours').textContent = String(hours).padStart(2, '0');
                document.getElementById('minutes').textContent = String(minutes).padStart(2, '0');
                document.getElementById('seconds').textContent = String(seconds).padStart(2, '0');
            } else {
                // ƒê√£ qua nƒÉm m·ªõi
                if (!isNewYear) {
                    isNewYear = true;
                    countdown.classList.remove('show');
                    newYearMessage.classList.add('show');
                    fireworksCanvas.classList.add('show');
                    startFireworks();
                }
            }
        }

        // ==================== FIREWORKS (Ph√°o hoa) ====================

        let fireworksContext;
        let fireworksArray = [];

        function startFireworks() {
            fireworksCanvas.width = window.innerWidth;
            fireworksCanvas.height = window.innerHeight;
            fireworksContext = fireworksCanvas.getContext('2d');

            // T·∫°o ph√°o hoa m·ªói 800ms
            setInterval(createFirework, 800);
            animateFireworks();
        }

        function createFirework() {
            const x = Math.random() * fireworksCanvas.width;
            const y = fireworksCanvas.height;
            const targetY = Math.random() * fireworksCanvas.height * 0.5;
            const color = `hsl(${Math.random() * 360}, 100%, 60%)`;

            fireworksArray.push({
                x: x,
                y: y,
                targetY: targetY,
                color: color,
                particles: [],
                exploded: false
            });
        }

        function animateFireworks() {
            requestAnimationFrame(animateFireworks);
            fireworksContext.fillStyle = 'rgba(0, 0, 0, 0.1)';
            fireworksContext.fillRect(0, 0, fireworksCanvas.width, fireworksCanvas.height);

            fireworksArray.forEach((firework, index) => {
                if (!firework.exploded) {
                    // Bay l√™n
                    firework.y -= 5;
                    fireworksContext.fillStyle = firework.color;
                    fireworksContext.beginPath();
                    fireworksContext.arc(firework.x, firework.y, 3, 0, Math.PI * 2);
                    fireworksContext.fill();

                    // N·ªï khi ƒë·∫°t ƒë·ªô cao
                    if (firework.y <= firework.targetY) {
                        firework.exploded = true;
                        for (let i = 0; i < 50; i++) {
                            firework.particles.push({
                                x: firework.x,
                                y: firework.y,
                                vx: (Math.random() - 0.5) * 8,
                                vy: (Math.random() - 0.5) * 8,
                                alpha: 1
                            });
                        }
                    }
                } else {
                    // V·∫Ω c√°c h·∫°t sau khi n·ªï
                    firework.particles.forEach((particle, pIndex) => {
                        particle.x += particle.vx;
                        particle.y += particle.vy;
                        particle.vy += 0.1; // Tr·ªçng l·ª±c
                        particle.alpha -= 0.01;

                        fireworksContext.fillStyle = firework.color.replace(')', `, ${particle.alpha})`).replace('hsl', 'hsla');
                        fireworksContext.beginPath();
                        fireworksContext.arc(particle.x, particle.y, 2, 0, Math.PI * 2);
                        fireworksContext.fill();

                        if (particle.alpha <= 0) {
                            firework.particles.splice(pIndex, 1);
                        }
                    });

                    // X√≥a ph√°o hoa khi h·∫øt h·∫°t
                    if (firework.particles.length === 0) {
                        fireworksArray.splice(index, 1);
                    }
                }
            });
        }

        // ==================== MUSIC CONTROL ====================

        function initMusicControl() {
            musicControl.addEventListener('click', toggleMusic);
        }

        function toggleMusic() {
            if (isMusicPlaying) {
                bgMusic.pause();
                musicIcon.innerHTML = '<path d="M3 9v6h4l5 5V4L7 9H3zm13.5 3c0-1.77-1.02-3.29-2.5-4.03v8.05c1.48-.73 2.5-2.25 2.5-4.02z"/>';
            } else {
                bgMusic.play().catch(e => console.log('Autoplay prevented:', e));
                musicIcon.innerHTML = '<path d="M16.5 12c0-1.77-1.02-3.29-2.5-4.03v2.21l2.45 2.45c.03-.2.05-.41.05-.63zm2.5 0c0 .94-.2 1.82-.54 2.64l1.51 1.51C20.63 14.91 21 13.5 21 12c0-4.28-2.99-7.86-7-8.77v2.06c2.89.86 5 3.54 5 6.71zM4.27 3L3 4.27 7.73 9H3v6h4l5 5v-6.73l4.25 4.25c-.67.52-1.42.93-2.25 1.18v2.06c1.38-.31 2.63-.95 3.69-1.81L19.73 21 21 19.73l-9-9L4.27 3zM12 4L9.91 6.09 12 8.18V4z"/>';
            }
            isMusicPlaying = !isMusicPlaying;
        }

        // ==================== MODAL ====================

        function initModal() {
            document.getElementById('btnShowMessage').addEventListener('click', () => {
                messageModal.classList.add('show');
            });

            document.getElementById('btnCloseModal').addEventListener('click', () => {
                messageModal.classList.remove('show');
            });

            messageModal.addEventListener('click', (e) => {
                if (e.target === messageModal) {
                    messageModal.classList.remove('show');
                }
            });
        }

        // ==================== RESIZE ====================

        function onWindowResize() {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);

            if (fireworksCanvas.classList.contains('show')) {
                fireworksCanvas.width = window.innerWidth;
                fireworksCanvas.height = window.innerHeight;
            }
        }

        // ==================== KH·ªûI ƒê·ªòNG ====================

        function init() {
            initThreeJS();
            animate();
            requestGyroPermission();
            useFallbackControls(); // Lu√¥n b·∫≠t fallback
            initTouchInteraction();
            initMusicControl();
            initModal();

            // C·∫≠p nh·∫≠t countdown m·ªói gi√¢y
            setInterval(updateCountdown, 1000);
            updateCountdown(); // G·ªçi ngay l·∫ßn ƒë·∫ßu
        }

        // Ch·∫°y khi trang load xong
        window.addEventListener('load', init);
    </script>
</body>
</html>